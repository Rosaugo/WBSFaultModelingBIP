

\section{Preliminaries}

%\subsection{The BIP Framework}

In this section, we briefly introduce the modelling framework of BIP and the statistical model checking for BIP.

The BIP framework \cite{bip11,atva15,concur16} advocates a component-based design methodology for building systems from atomic components. 
 In this work, we relay on the fragment of BIP with multiparty synchronization and data transfer.
% We do not take into account in this work, as in the previous work~\cite{dfinder10,tgc15}, since adding priority will not introduce any errors.
% If a model without priority is safe, then after adding priority constraints it remains safe.
 Formally, an atomic BIP component is defined by an automaton extended with data and port.

\begin{definition} [BIP component]
	\label{component-def}
	Given a finite set of variables $\bipvar{}$, 
    an atomic BIP component is defined as a tuple $\comp{} = \mktuple{\bipvar{}, \locs{}, \ports{}, \edges{}, \ell}$, 
    where
	\begin{inparaenum}
		\item $\locs{}$ is a finite set of control locations;
		\item $\ports{}$ is a finite set of communication ports;
		\item $\edges{} \subseteq \locs{} \times \ports{} \times \bexp{\bipvar{}} \times \expr{\bipvar{}} \times \locs{}$
		is a finite set of transition edges extended with guards in $\bexp{\bipvar{}}$
		and operations in $\expr{\bipvar{}}$;
		\item $\ell \in \locs{}$ is an initial control location.
	\end{inparaenum}
\end{definition}

Transition edges in a component are labeled by ports, which form the interface of the component.
We assume that, from each control location, every pair of outgoing transitions have different ports, and the ports of different components are disjoint.
In other words, transitions with the same ports in the component are not enabled simultaneously.
 Given a component violating such assumptions, one can easily transform it into the required form by renaming the ports, while retaining the BIP expressiveness power.
 To ease the presentation, we denote in the sequel by $\portid{p}$ the unique component where port $p$ is defined.

%Given a tuple of component types $\overline{\comptype{}} = \mktuple{\comptype{1},\ldots, \comptype{k}}$,
%and a tuple of natural numbers $\overline{n} = \mktuple{n_{1}, \ldots, n_{k}}$,
%where $n_{i}$ represents the number of instantiations of $\comptype{i}$,
%

We denote by $\components = \{\comp{i} ~|~ i\in [1,n]\}$ a set of components.
%instantiated from $\overline{\comptype{}}$.
%where $\comptype{i}[j]$
%$\comptype{i}[j] = \mktuple{\bipvar{i}[j] ,\locs{i}[j] ,\ports{i}[j], \edges{i}[j], \ell_{i}[j] }$
%is the $j^{th}$ instantiation of component type $\comptype{i}$.
%
%Given a set of comoponents $\components$,
The coordination of components is specified by using interactions.
%and in \BIP an interaction is represented as a finite set of ports.

\begin{definition} [Interaction]
	\label{interaction}
	An interaction for $\components $ is a tuple $\gamma = \mktuple{g, \mathcal{P}, f } $,
	where $g \in \bexp{\bipvar{}}$, $f\in \expr{\bipvar{}}$ and
	$\mathcal{P} \subseteq \bigcup_{i=1}^n \ports{i}$, $\mathcal{P} \neq \emptyset$, and
	for all $i \in [1, n]$, $|\mathcal{P} \cap \ports{i}| \le 1$.
\end{definition}

Intuitively, an interaction defines a guarded multiparty synchronization with data transfer:
when the guard $g$ of an interaction $\mathcal{P}$ is enabled,
then the data transfer specified by $f$ can be executed, and
after that the transitions labelled by the ports in $\gamma$ can be taken simultaneously.
We denote by $\Gamma$ a finite set of interactions.

A \BIP model is constructed by composing a number of components with interactions.

\begin{definition} [\BIP Model]
	A \BIP model $\bipmodel$ is a tuple $\mktuple{\components,\Gamma}$,
	where $\components$ is a finite set of components,
	and $\Gamma$ is a finite set of interactions for $\components$.
\end{definition}



A state of a \BIP model is denoted by a tuple $c = \langle \compstate{1}, \ldots, \compstate{n} \rangle $,
where for all $i \in [1,n] $, $l_i \in \locs{i} $ and $\mathbf{V}_i $ is a valuation of $\bipvar{i}$.
%
%We denote by $c(i,j), i\in[1,k]$ the state $\mktuple{l_{i}^{j}, s_{i}^{j}}$ of component $\comptype{i}[j]$.
%$c_0=\mktuple{\mktuple{l_1,s_1},\ldots, \ldots, \mktuple{l_n,s_n}}$
A state $c_{0}$ is initial if for all $i \in [1,n]$,
$l_i = \ell_{i}$ and $\mathbf{V}_{i}$ is the initial valuation of $\bipvar{i}$.
%
A state $c$ is an error if for some $i \in [1,n]$, $l_{i}$ is an error location.
%
We say an interaction $\gamma \in \Gamma$ is enabled on a state $c$ if
for every component $\comp{i} \in \components$,
such that $\gamma \cap \ports{i} \neq \emptyset$,
%
there is an edge $\mktuple{l_i, \gamma \cap \ports{i}, g_i, f_i, l_{i}' } \in \edges{i}$
and  $\mathbf{V}_{i} \models g_i $.
%
Then we define the semantics of a \BIP model by a labeled transition system.

\begin{definition} [Labeled transition system of \BIP]
	\label{operational-semantics}
	Given a \BIP model $\bipmodel=\mktuple{\components,\Gamma}$, the labeled transition system it defines is a tuple
	$\TS{\BIP} = \mktuple{\mathcal{C}, \Sigma, \mathcal{R}, \mathcal{C}_{0}}$, where
	%
	\begin{enumerate}
		\item $\mathcal{C}$ is the set of states,
		\item $\Sigma = \Gamma $,
		\item $\mathcal{R}$ is the set of transitions,
		and we say that there is a transition from a state $c$
		%$c=\mktuple{\mktuple{l_1,s_1}, \ldots, \mktuple{l_n,s_n}} $
		to another state $c'$,
		%$c'=\mktuple{\mktuple{l_1',s_1'}, \ldots, \mktuple{l_n',s_n'}}$
		if there is an interaction $\gamma $ such that,
		%
		\begin{enumerate}
			%\begin{inparaenum}[(i)]
			\item $\gamma$ is enabled in $c$;
			\item for all $\comp{i} \in \mathbb{B}$ such that
			$\gamma \cap \ports{i} \neq \emptyset$, there is an edge
			$\mktuple{l_i, \gamma \cap \ports{i}, g_i, f_i, l_i'} \in \edges{i} $,
			%and if $f_i = x := e $,
			then $\mathbf{V}'_{i} = \mathbf{V}_{i}[\bipvar{} / f_i(\bipvar{})]$;
			\item for all $\comp{i} \in \mathbb{B} $ such that
			$\gamma \cap \ports{i} = \emptyset $,
			$l_i' = l_i$ and $\mathbf{V}_i' = \mathbf{V}_i$.
			%\end{inparaenum}
		\end{enumerate}
		\item $\mathcal{C}_{0}$ is the set of initial states.
	\end{enumerate}
\end{definition}

%We denote by $c \overset{\gamma} \rightarrow c'$ that
%there is a transition from state $c$ to state $c'$, following the interaction $\gamma$.
%
%We denote by $\rho$
%
%A state $c$ % $c=\mktuple{\mktuple{l_1,s_1}, \ldots, \mktuple{l_n,s_n}}$
%is reachable if there is a trace
%$c_0, c_1, \ldots, c_k$ such that
%$c_0 \xrightarrow{\gamma_1} c_1 \xrightarrow{\gamma_2} \ldots \xrightarrow{\gamma_k} c $,
%from an initial configuration $c_{0}$ to $ c$.
%

%\subsection{Statistical Model Checking for BIP}

In the stochastic extension of BIP, we can add stochastic behavior to atomic components by declaring probabilistic variables.
 A probabilistic variable $x^{P}$ is attached to given distributions $\mu_{x}^{P}$ and can be updated on transitions using the attached distribution.
 The semantics is thus fully stochastic.
 We refer to \cite{sbip18} for details.
 
Given a stochastic system model $\bipmodel$ and a property specification $\phi$, 
 statistical model checking refers to a series of simulation-based techniques 
 that can be used to answer two questions: 
 (1) Qualitative: Is the probability for $\bipmodel$ to satisfy $\phi$ greater or equal to a certain threshold $\theta$ ? and 
 (2) Quantitative: What is the probability for $\bipmodel$ to satisfy $\phi$?
 Let $B_i$ be a discrete random variable with a Bernoulli distribution of parameter $p$. 
 Such a variable can only take 2 values 0 and 1 with $Pr[B_i = 1] = p$ and $Pr[B_i = 0] = 1-p$.
 In our context, each variable $B_i$ is associated with one simulation of the system. 
 The outcome for $B_i$,  denoted $b_i$, is 1 if the $i$-th simulation satisfies $\phi$ and 0 otherwise.
 The approaches and algorithms to solve the above questions are out of the scope of this paper.
 We refer to \cite{smc-past} for more information.